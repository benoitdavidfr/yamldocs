title: journal de mise au point de l'action genEvols d'index.php
created: 2020-04-11
2020-04-10: |
  - réorganisation du code en créant les classes Verbose, Base et GroupMvts
  - exécution du code jusqu'au 2000-01-01
  - développement de l'action compare pour comparer 2 fichiers Yaml
  - le fichier coms2000-01-01gen.yaml généré par genEvols est sensiblement différent de celui coms2000-01-01insee.yaml
    fourni par l'INSEE
  - une première analyse des écarts met en lumière des bugs dans l'action genEvols, notamment sur 04112
2020-04-11:
  - redev du cas 21 de genEvols pour traiter 04112
  - diff sur Autun (71014)
    - traitée
2020-04-12:
  69385:
    extraitDeGenEvols: |
      $group:
        mod: '21'
        label: Rétablissement
        date: '1964-08-12'
        mvts:
          - { avant: { type: ARM, id: '69385', name: 'Lyon 5e Arrondissement' }, après: { type: ARM, id: '69385', name: 'Lyon 5e Arrondissement' } }
          - { avant: { type: ARM, id: '69385', name: 'Lyon 5e Arrondissement' }, après: { type: ARM, id: '69389', name: 'Lyon 9e Arrondissement' } }
      factorAvant:
          69385: { type: ARM, name: 'Lyon 5e Arrondissement', après: { 69385: { type: ARM, name: 'Lyon 5e Arrondissement' }, 69389: { type: ARM, name: 'Lyon 9e Arrondissement' } } }
    WikipédiaSignale: |
      Par un décret du 1er août 1963, la commune de Saint-Rambert-l'Île-Barbe est rattachée au 5e arrondissement
      qui est lui-même scindé en deux par un décret du 12 août 1964, la partie septentrionale devenant le 9e arrondissement. 
    plusieursProblèmes:
      - je ne comprends pas l'input, ce devrait être une création et pas un Rétablissement
      - le 9e arrondissement existe déjà dans com1943
      - même problème avec le 7ème (69387) et 8ème (69388)
      - j'ai dans mon code un pb de visibilité des alertes
    solution:
      - définition d'un mécanisme d'erreur et d'alerte 
      - j'ignore ces évts en les documentant en remontant une alerte
  mod10:
    - je complète le code insuffisant
    - des alertes sont remontées 
  mvtsPatterns:
    intro:
      - il existe différents motifs dans le fichier des mouvements
      - en codant au fur et à mesure des cas particuliers, le code fait l'hypothèse de certains d'entre eux sans les expliciter
      - il serait utile de formaliser ces motifs pour améliorer le code
      - -> http://localhost/yamldoc/pub/evolcoms/?action=mvtsPatterns
      - dans un premier temps j'en trouve 123, il faudrait réduire ce nombre car certains motifs sont très similaires
      - il faut définir des règles de simplification
      - cette simplification correspond à une standardisation des factorAvant
        - elle peut être réalisée lors de l'appel de factorAvant()
        - avec qqs principes
          - mettre en premier les règles ayant plusieurs après
          - trier dans les après dans l'ordre des id{i}
      - cette simplication permet de passer à 79 motifs
      - 2ème étape, faire des motifs de motifs !
      - idée - définir un module générant les motifs et essayer de couvrir ceux détectés
2020-04-15:
  mvtsPatterns:
    - chgt du format des évols et motifs car certains éléments ayant même code INSEE entre entité déléguée et non était supprimés
    - génération de 206 motifs dont 121 pour la création de commune nouvelle
idéeCodeInsee:
  - dans une base utilisant les codes Insee
    - garder ceux qui ont été utilisés sans les modifier
    - donner un moyen de géocoder des codes INSEE qui ont été valides depuis 1943
  - créer un référentiel avec tous les codes INSEE qui ont été valides depuis 1943
    - associer à chaque code INSEE une succession de versions
    - associer à chaque version un nom, un statut et une localisation géographique
structuration:
  {codeInsee}: // tous les codes ayant existé
    // {date} est la date d'une version d'une propriété ou 1/1/1943 pour la propriété initiale
    // propriétés versionnées d'une commune S/A/D correspondant au code INSEE
    name: { {date}: {nom} } // versions des noms, si S+D le nom de la déléguante
    geo: { {date}: {east: {latitude}, north: {longitude}} } // un point dans son territoire, idéalement son chef-lieu
    spatial: { {date}: {northlimit: {lat}, southlimit: {lat}, westlimit: {lon}, eastlimit: {lon}} } // son emprise spatiale
    population: { {date}: {population}} // population officielle à une date donnée
    associéeA?: { {date}: {codeInsee}} // si la c. est associée alors le c. INSEE de la commune à laquelle elle est associée
    déléguéeDe?: { {date}: {codeInsee}} // si la c. est déléguée alors le c. INSEE de la c. dont elle l'est, evt elle-même
    commeDéléguée?: // si la commune est déléguée d'elle même cette partie comprend les propriétés de la c. déléguée
      name: { {date}: {nom} }
      geo: {{date}: {latitude} {longitude}} // un point dans son territoire de déléguée, idéalement son chef-lieu
      spatial: {{date}: {northlimit: {lat}, southlimit: {lat}, westlimit: {lon}, eastlimit: {lon}}} // l'emp. s. de déléguée
    // propriétés indiquant la disparition ou la recréation de l'entité
    status:
      {date}:
        absorbéePar?: {codeInsee} // si la c. a été absorbée dans une fusion simple ou une c. nouvelle sans c. déléguée
        dissouteDans?: [{codeInsee}] // si la c. a été supprimée alors les c. dans lesquelles son territoire a été réparti
        rétablie?: {codeInsee} // si la c. S/A/D a été rétablie alors la c. dont elle est issue
examples:
  
idéeEmboitementDePartitions:
  - autre idée - formaliser comme emboitement de partitions
  - le territoire Met+DOM correspond à 2 partitions emboitées
  - 1) partition en communes simples
  - 2) chaque commune simple peut correspondre soit
    - une partition en communes de 2nd niveau, cad c. associées + la commune simple ss les c. associées
    - une partition en communes déléguées,
    - une partition en ARM,
    - soit non partitionnée
  - je représente ces partitions de la manière suivante
  - C'est quasiment la même chose que exfcoms.yaml
représentation:
  note:
    - Une commune simple peut-elle avoir simultanément des communes associées et déléguées ?
      - ou bien lors de la création d'une c. nouvelle les c. associées sont-elles forcément soit rétablies soit intégrées
    - Une commune associée peut-elle être déléguante ?
    - je fais l'hypothèse que lors de la création d'une commune nouvelle les c. associées sont soit rétablies, soit intégrées
  {idComS}: # à ce niveau j'ai tous les codes INSEE des communes simples, cad ni associées, ni déléguées
    name: {nom}
    associées: # liste des communes associées à {idComS}
      {idComA}:
        name: {nom}
    déléguées: # liste des communes déléguées de {idComS}
      {idComD}:
        name: {nom}
    ardMun: # liste des arrondissements municipaux de {idComS}
      {idArdMun}:
        name: {nom}
eof:
